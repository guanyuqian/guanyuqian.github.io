(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{758:function(t,a,r){"use strict";r.r(a);var s=r(3),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"title"}),r("p",[t._v("听了一个Go语言最佳实践的代码风格讲座，在这里记录一下笔记。")])]),t._v(" "),r("h2",{attrs:{id:"_1-可读性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-可读性"}},[t._v("#")]),t._v(" 1. 可读性")]),t._v(" "),r("h3",{attrs:{id:"_1-1-if-else"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-if-else"}},[t._v("#")]),t._v(" 1.1 if/else")]),t._v(" "),r("ul",[r("li",[t._v("避免 else return，尽早 return")]),t._v(" "),r("li",[t._v("keep happy path unindented：让所有事情正常发生时执行的路径不要缩进，遇到错误马上返回")]),t._v(" "),r("li",[t._v("避免不必要的 else")])]),t._v(" "),r("h3",{attrs:{id:"_1-2-init"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-init"}},[t._v("#")]),t._v(" 1.2 Init()")]),t._v(" "),r("ul",[r("li",[t._v("Init函数会让可读性变差、带来意料之外的副作用， 最好是提供相应初始化函数给调用者来避免使用init")]),t._v(" "),r("li",[t._v("如果一定要使用，那么应该在init函数中避免I/O调用（单元测试时不希望有）、避免依赖其它的 init() 函数、避免修改全局函数、环境状态")])]),t._v(" "),r("h3",{attrs:{id:"_1-3-comments"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-comments"}},[t._v("#")]),t._v(" 1.3 Comments")]),t._v(" "),r("ul",[r("li",[t._v("可以使用"),r("code",[t._v("/* */")]),t._v("去注释"),r("strong",[t._v("magic param")]),t._v(" ，比如： "),r("code",[t._v("callFun(uid, true /* param meaning*/)")])]),t._v(" "),r("li",[t._v("每个package都需要一个注释，package的注释位置：如果是比较小的包就放在package的同名go文件中，如果比较大的包就放在特地的注释go文件"),r("code",[t._v("doc.go")]),t._v("中")]),t._v(" "),r("li",[t._v("What instead of How，避免解释代码的运行逻辑，而是解释函数的功能")]),t._v(" "),r("li",[t._v("行注释开头为注释对象名称，结尾为句号，为了让godoc之类工具可以更好解析注释")])]),t._v(" "),r("h2",{attrs:{id:"_2-可靠性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-可靠性"}},[t._v("#")]),t._v(" 2. 可靠性")]),t._v(" "),r("h3",{attrs:{id:"_2-1-panic"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-panic"}},[t._v("#")]),t._v(" 2.1 Panic")]),t._v(" "),r("ul",[r("li",[t._v("当出现无法恢复的error和人为错误时才考虑使用panic")]),t._v(" "),r("li",[t._v("可以使用defer来承接panic的recover功能")])]),t._v(" "),r("h3",{attrs:{id:"_2-2-error"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-error"}},[t._v("#")]),t._v(" 2.2 Error")]),t._v(" "),r("ul",[r("li",[t._v("自定义错误：创建一个实现了 Error() 和 Unwrap() 函数的结构体")]),t._v(" "),r("li",[t._v("使用 "),r("code",[t._v('fmt.Errorf("context: %w", err)')]),t._v("来重构error，让error的上下文更加丰富")]),t._v(" "),r("li",[t._v("在go1.13后不使用 == 去判断error，使用 errors.Is(err, xxError) 判断是否是某种错误")]),t._v(" "),r("li",[t._v("在go1.13后不使用 .(xxError) 去断言error的类型，使用 errors.As(err, xxError) 判断错误是否是特定类型")])]),t._v(" "),r("h2",{attrs:{id:"_3-性能"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-性能"}},[t._v("#")]),t._v(" 3. 性能")]),t._v(" "),r("h3",{attrs:{id:"_3-1-指针"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-指针"}},[t._v("#")]),t._v(" 3.1 指针")]),t._v(" "),r("ul",[r("li",[t._v("在以下场景使用指针：函数中需要修改参数内容、传递大的数据时、项目代码风格要求")]),t._v(" "),r("li",[t._v("在以下场景不使用指针：函数不需要修改参数内容、小数据传递、传递interface的指针")]),t._v(" "),r("li",[t._v("go默认是值传递的，不要对循环中的变量取地址")])]),t._v(" "),r("p",[t._v("3.2 弃用（Deprecation）")]),t._v(" "),r("ul",[r("li",[t._v("增加对新目标的单元测试，结果应该和弃用目标的单元测试结果一致")]),t._v(" "),r("li",[t._v("在行注释中标记弃用理由")])]),t._v(" "),r("div",{staticClass:"language-go line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-go"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Function do some thing.")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Deprecated: 弃用理由.")]),t._v("\nfun "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Function")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br"),r("span",{staticClass:"line-number"},[t._v("4")]),r("br"),r("span",{staticClass:"line-number"},[t._v("5")]),r("br"),r("span",{staticClass:"line-number"},[t._v("6")]),r("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);